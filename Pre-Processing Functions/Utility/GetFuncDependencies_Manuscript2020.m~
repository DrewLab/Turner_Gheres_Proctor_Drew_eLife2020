function [] = GetFuncDependencies_Manuscript2020(functionName)
%________________________________________________________________________________________________________________________
% Written by Kevin L. Turner
% The Pennsylvania State University, Dept. of Biomedical Engineering
% https://github.com/KL-Turner
%________________________________________________________________________________________________________________________
%
%   Purpose: Outputs all dependencies of a given function, including subfunction dependencies. It also verifies this by
%            looping through each subfunction and further checking that it doesn't have any dependencies.
%________________________________________________________________________________________________________________________

% control for input
if nargin == 0
    functionName = input('Input function name: ','s');
end
% Detect OS and set delimeter to correct value. This typically isn't necessary in newer versions of Matlab.
if isunix
    delimiter = '/';
elseif ispc
    delimiter = '\';
else
    disp('Platform not currently supported');
    return
end

% Attempt to use Matlab's codetool feature to detect function dependencies.
try
    [fList,~] = matlab.codetools.requiredFilesAndProducts(functionName);
catch
    % Catch the instance where the filename does not exist or was spelled incorrectly.
    disp(['Matlab function ' functionName ' does not appear to exist or to be included in the current filepath(s)']);
    return
end

% Find the unique functions listed and pull the names out.
uniqueFuncPaths = unique(fList);
allDepFuncNames = cell(size(uniqueFuncPaths,2),1);
allDepFuncPaths = cell(size(uniqueFuncPaths,2),1);
for x = 1:size(uniqueFuncPaths, 2)
    allDepFuncPaths{x,1} = uniqueFuncPaths{1,x};
    funcDelimiters = strfind(allDepFuncPaths{x,1},delimiter);
    allDepFuncNames{x,1} = char(strip(allDepFuncPaths{x,1}(funcDelimiters(end):end),delimiter));
end
functionList.names = allDepFuncNames;
functionList.paths = allDepFuncPaths;

allFileNames = {};   % Pre-alloc
allFilePaths = {};   % Pre-alloc
% Generate results table if this is the last animal. This value is hard-coded for this specific analysis.
for aa = 1:length(functionList.names)
    tableVals{aa,1} = sortrows(horzcat(functionList.names{aa,1}, functionList.paths{aa,1}));
    fileNames{aa,1} = tableVals{aa,1}(:,1);
    filePaths{aa,1} = tableVals{aa,1}(:,2);
    allFileNames = vertcat(allFileNames,fileNames{aa,1});
    allFilePaths = vertcat(allFilePaths,filePaths{aa,1});
end
% Table
T = table(allFileNames,allFilePaths,'VariableNames',{'File_names','File_paths'});
figure('Name','Function dependencies table','NumberTitle','off')
u = uitable('Data',T{:,:},'ColumnName',T.Properties.VariableNames,'RowName',T.Properties.RowNames,'Units','Normalized','Position',[0,0,1,1]);
set(u,'ColumnWidth',{300})
pause(1)

end
